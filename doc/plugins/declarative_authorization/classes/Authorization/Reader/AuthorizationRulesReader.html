<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Authorization::Reader::AuthorizationRulesReader</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Authorization::Reader::AuthorizationRulesReader</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/vendor/plugins/declarative_authorization/lib/declarative_authorization/reader_rb.html">
                vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000201">contains</a>&nbsp;&nbsp;
      <a href="#M000194">description</a>&nbsp;&nbsp;
      <a href="#M000202">does_not_contain</a>&nbsp;&nbsp;
      <a href="#M000193">has_omnipotence</a>&nbsp;&nbsp;
      <a href="#M000192">has_permission_on</a>&nbsp;&nbsp;
      <a href="#M000197">if_attribute</a>&nbsp;&nbsp;
      <a href="#M000198">if_permitted_to</a>&nbsp;&nbsp;
      <a href="#M000191">includes</a>&nbsp;&nbsp;
      <a href="#M000203">intersects_with</a>&nbsp;&nbsp;
      <a href="#M000199">is</a>&nbsp;&nbsp;
      <a href="#M000204">is_in</a>&nbsp;&nbsp;
      <a href="#M000200">is_not</a>&nbsp;&nbsp;
      <a href="#M000205">is_not_in</a>&nbsp;&nbsp;
      <a href="#M000190">role</a>&nbsp;&nbsp;
      <a href="#M000195">title</a>&nbsp;&nbsp;
      <a href="#M000196">to</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000201" class="method-detail">
        <a name="M000201"></a>

        <div class="method-heading">
          <a href="#M000201" class="method-signature">
          <span class="method-name">contains</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
In an <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
statement, <a href="AuthorizationRulesReader.html#M000201">contains</a>
says that the value has <a
href="AuthorizationRulesReader.html#M000196">to</a> be part of the
collection specified by the <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a> attribute.
For information on the block argument, see <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000201-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000201-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 444</span>
444:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">contains</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
445:         [<span class="ruby-identifier">:contains</span>, <span class="ruby-identifier">block</span>]
446:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000194" class="method-detail">
        <a name="M000194"></a>

        <div class="method-heading">
          <a href="#M000194" class="method-signature">
          <span class="method-name">description</span><span class="method-args">(text)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets a <a href="AuthorizationRulesReader.html#M000194">description</a> for
the current <a href="AuthorizationRulesReader.html#M000190">role</a>. E.g.
</p>
<pre>
  role :admin
    description &quot;To be assigned to administrative personnel&quot;
    has_permission_on ...
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000194-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000194-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 286</span>
286:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">description</span> (<span class="ruby-identifier">text</span>)
287:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;description only allowed in role blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_role</span>.<span class="ruby-identifier">nil?</span>
288:         <span class="ruby-identifier">role_descriptions</span>[<span class="ruby-ivar">@current_role</span>] = <span class="ruby-identifier">text</span>
289:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000202" class="method-detail">
        <a name="M000202"></a>

        <div class="method-heading">
          <a href="#M000202" class="method-signature">
          <span class="method-name">does_not_contain</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The negation of <a
href="AuthorizationRulesReader.html#M000201">contains</a>. Currently, query
rewriting <a href="AuthorizationRulesReader.html#M000199">is</a> disabled
for <a href="AuthorizationRulesReader.html#M000202">does_not_contain</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000202-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000202-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 450</span>
450:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">does_not_contain</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
451:         [<span class="ruby-identifier">:does_not_contain</span>, <span class="ruby-identifier">block</span>]
452:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000193" class="method-detail">
        <a name="M000193"></a>

        <div class="method-heading">
          <a href="#M000193" class="method-signature">
          <span class="method-name">has_omnipotence</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes any permission checks for the current <a
href="AuthorizationRulesReader.html#M000190">role</a>.
</p>
<pre>
  role :admin
    has_omnipotence
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000193-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000193-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 276</span>
276:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_omnipotence</span>
277:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;has_omnipotence only allowed in role blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_role</span>.<span class="ruby-identifier">nil?</span>
278:         <span class="ruby-ivar">@omnipotent_roles</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@current_role</span>
279:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000192" class="method-detail">
        <a name="M000192"></a>

        <div class="method-heading">
          <a href="#M000192" class="method-signature">
          <span class="method-name">has_permission_on</span><span class="method-args">(*args) {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allows the definition of privileges <a
href="AuthorizationRulesReader.html#M000196">to</a> be allowed for the
current <a href="AuthorizationRulesReader.html#M000190">role</a>, either in
a <a href="AuthorizationRulesReader.html#M000192">has_permission_on</a>
block or directly in one call.
</p>
<pre>
  role :admin
    has_permission_on :employees, :to =&gt; :read
    has_permission_on [:employees, :orders], :to =&gt; :read
    has_permission_on :employees do
      to :create
      if_attribute ...
    end
    has_permission_on :employees, :to =&gt; :delete do
      if_attribute ...
    end
  end
</pre>
<p>
The block form allows <a
href="AuthorizationRulesReader.html#M000196">to</a> describe restrictions
on the permissions using <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a>. Multiple <a
href="AuthorizationRulesReader.html#M000192">has_permission_on</a>
statements are OR&#8216;ed when evaluating the permissions. Also, multiple
<a href="AuthorizationRulesReader.html#M000197">if_attribute</a> statements
in one block are OR&#8216;ed if no :<tt>join_by</tt> option <a
href="AuthorizationRulesReader.html#M000199">is</a> given (see below). To
AND conditions, either set :<tt>join_by</tt> <a
href="AuthorizationRulesReader.html#M000196">to</a> :and or place them in
one <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
statement.
</p>
<p>
Available options
</p>
<dl>
<dt>:<tt><a href="AuthorizationRulesReader.html#M000196">to</a></tt></dt><dd>A symbol or an array of symbols representing the privileges that should be
granted in this statement.

</dd>
<dt>:<tt>join_by</tt></dt><dd>Join operator <a href="AuthorizationRulesReader.html#M000196">to</a>
logically connect the constraint statements inside of the <a
href="AuthorizationRulesReader.html#M000192">has_permission_on</a> block.
May be :<tt>and</tt> or :<tt>or</tt>. Defaults <a
href="AuthorizationRulesReader.html#M000196">to</a> :<tt>or</tt>.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000192-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000192-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 248</span>
248:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_permission_on</span> (<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
249:         <span class="ruby-identifier">options</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">extract_options!</span>
250:         <span class="ruby-identifier">context</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>
251:         
252:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;has_permission_on only allowed in role blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_role</span>.<span class="ruby-identifier">nil?</span>
253:         <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-identifier">:join_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:or</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
254:         
255:         <span class="ruby-identifier">privs</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:to</span>] 
256:         <span class="ruby-identifier">privs</span> = [<span class="ruby-identifier">privs</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">privs</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
257:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;has_permission_on either needs a block or :to option&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">privs</span>.<span class="ruby-identifier">empty?</span>
258: 
259:         <span class="ruby-identifier">file</span>, <span class="ruby-identifier">line</span> = <span class="ruby-identifier">file_and_line_number_from_call_stack</span>
260:         <span class="ruby-identifier">rule</span> = <span class="ruby-constant">AuthorizationRule</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@current_role</span>, <span class="ruby-identifier">privs</span>, <span class="ruby-identifier">context</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:join_by</span>],
261:                    <span class="ruby-identifier">:source_file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span>, <span class="ruby-identifier">:source_line</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>)
262:         <span class="ruby-ivar">@auth_rules</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rule</span>
263:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
264:           <span class="ruby-ivar">@current_rule</span> = <span class="ruby-identifier">rule</span>
265:           <span class="ruby-keyword kw">yield</span>
266:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;has_permission_on block content specifies no privileges&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">privileges</span>.<span class="ruby-identifier">empty?</span>
267:           <span class="ruby-comment cmt"># TODO ensure?</span>
268:           <span class="ruby-ivar">@current_rule</span> = <span class="ruby-keyword kw">nil</span>
269:         <span class="ruby-keyword kw">end</span>
270:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000197" class="method-detail">
        <a name="M000197"></a>

        <div class="method-heading">
          <a href="#M000197" class="method-signature">
          <span class="method-name">if_attribute</span><span class="method-args">(attr_conditions_hash)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
In a <a href="AuthorizationRulesReader.html#M000192">has_permission_on</a>
block, <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
specifies conditions of dynamic parameters that have <a
href="AuthorizationRulesReader.html#M000196">to</a> be met for the user <a
href="AuthorizationRulesReader.html#M000196">to</a> meet the privileges in
this block. Conditions are evaluated on the context object. Thus, the
following allows CRUD for branch admins only on employees that belong <a
href="AuthorizationRulesReader.html#M000196">to</a> the same branch as the
current user.
</p>
<pre>
  role :branch_admin
    has_permission_on :employees do
      to :create, :read, :update, :delete
      if_attribute :branch =&gt; is { user.branch }
    end
  end
</pre>
<p>
In this case, <a href="AuthorizationRulesReader.html#M000199">is</a> <a
href="AuthorizationRulesReader.html#M000199">is</a> the operator for
evaluating the condition. Another operator <a
href="AuthorizationRulesReader.html#M000199">is</a> <a
href="AuthorizationRulesReader.html#M000201">contains</a> for collections.
In the block supplied <a
href="AuthorizationRulesReader.html#M000196">to</a> the operator,
<tt>user</tt> specifies the current user for whom the condition <a
href="AuthorizationRulesReader.html#M000199">is</a> evaluated.
</p>
<p>
Conditions may be nested:
</p>
<pre>
  role :company_admin
    has_permission_on :employees do
      to :create, :read, :update, :delete
      if_attribute :branch =&gt; { :company =&gt; is {user.branch.company} }
    end
  end
</pre>
<p>
has_many and has_many through associations may also be nested. Then, at
least one item in the association needs <a
href="AuthorizationRulesReader.html#M000196">to</a> fulfill the subsequent
condition:
</p>
<pre>
  if_attribute :company =&gt; { :branches =&gt; { :manager =&gt; { :last_name =&gt; is { user.last_name } } }
</pre>
<p>
Beware of possible performance issues when using has_many associations in
permitted_to? checks. For
</p>
<pre>
  permitted_to? :read, object
</pre>
<p>
a check like
</p>
<pre>
  object.company.branches.any? { |branch| branch.manager ... }
</pre>
<p>
will be executed. with_permission_to scopes construct efficient SQL joins,
though.
</p>
<p>
Multiple attributes in one :<a
href="AuthorizationRulesReader.html#M000197">if_attribute</a> statement are
AND&#8216;ed. Multiple <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a> statements
are OR&#8216;ed if the join operator for the <a
href="AuthorizationRulesReader.html#M000192">has_permission_on</a> block
isn&#8216;t explicitly set. Thus, the following would require the current
user either <a href="AuthorizationRulesReader.html#M000196">to</a> be of
the same branch AND the employee <a
href="AuthorizationRulesReader.html#M000196">to</a> be
&quot;changeable_by_coworker&quot;. OR the current user has <a
href="AuthorizationRulesReader.html#M000196">to</a> be the employee in
question.
</p>
<pre>
  has_permission_on :employees, :to =&gt; :manage do
    if_attribute :branch =&gt; is {user.branch}, :changeable_by_coworker =&gt; true
    if_attribute :id =&gt; is {user.id}
  end
</pre>
<p>
The join operator for <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a> rules can
explicitly set <a href="AuthorizationRulesReader.html#M000196">to</a> AND,
though. See <a
href="AuthorizationRulesReader.html#M000192">has_permission_on</a> for
details.
</p>
<p>
Arrays and fixed values may be used directly as hash values:
</p>
<pre>
  if_attribute :id   =&gt; 1
  if_attribute :type =&gt; &quot;special&quot;
  if_attribute :id   =&gt; [1,2]
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000197-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000197-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 368</span>
368:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">if_attribute</span> (<span class="ruby-identifier">attr_conditions_hash</span>)
369:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;if_attribute only in has_permission blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_rule</span>.<span class="ruby-identifier">nil?</span>
370:         <span class="ruby-identifier">parse_attribute_conditions_hash!</span>(<span class="ruby-identifier">attr_conditions_hash</span>)
371:         <span class="ruby-ivar">@current_rule</span>.<span class="ruby-identifier">append_attribute</span> <span class="ruby-constant">Attribute</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">attr_conditions_hash</span>)
372:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000198" class="method-detail">
        <a name="M000198"></a>

        <div class="method-heading">
          <a href="#M000198" class="method-signature">
          <span class="method-name">if_permitted_to</span><span class="method-args">(privilege, attr_or_hash = nil, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="AuthorizationRulesReader.html#M000198">if_permitted_to</a> allows
the <a href="AuthorizationRulesReader.html#M000192">has_permission_on</a>
block <a href="AuthorizationRulesReader.html#M000196">to</a> depend on
permissions on associated objects. By using it, the authorization rules may
be a lot DRYer. E.g.:
</p>
<pre>
  role :branch_manager
    has_permission_on :branches, :to =&gt; :manage do
      if_attribute :employees =&gt; includes { user }
    end
    has_permission_on :employees, :to =&gt; :read do
      if_permitted_to :read, :branch
      # instead of
      # if_attribute :branch =&gt; { :employees =&gt; includes { user } }
    end
  end
</pre>
<p>
<a href="AuthorizationRulesReader.html#M000198">if_permitted_to</a>
associations may be nested as well:
</p>
<pre>
  if_permitted_to :read, :branch =&gt; :company
</pre>
<p>
You can even use has_many associations as target. Then, it <a
href="AuthorizationRulesReader.html#M000199">is</a> checked if the current
user has the required privilege on <b>any</b> of the target objects.
</p>
<pre>
  if_permitted_to :read, :branch =&gt; :employees
</pre>
<p>
Beware of performance issues with permission checks. In the current
implementation, all employees are checked until the first permitted <a
href="AuthorizationRulesReader.html#M000199">is</a> found.
with_permissions_to, on the other hand, constructs more efficient SQL
instead.
</p>
<p>
To check permissions based on the current object, the attribute has <a
href="AuthorizationRulesReader.html#M000196">to</a> be left out:
</p>
<pre>
  has_permission_on :branches, :to =&gt; :manage do
    if_attribute :employees =&gt; includes { user }
  end
  has_permission_on :branches, :to =&gt; :paint_green do
    if_permitted_to :update
  end
</pre>
<p>
Normally, one would merge those rules into one. Deviding makes sense if
additional <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
are used in the second rule or those rules are applied <a
href="AuthorizationRulesReader.html#M000196">to</a> different roles.
</p>
<p>
Options:
</p>
<dl>
<dt>:<tt>context</tt></dt><dd>When using with_permissions_to, the target context of the <a
href="AuthorizationRulesReader.html#M000198">if_permitted_to</a> statement
<a href="AuthorizationRulesReader.html#M000199">is</a> infered from the
last reflections target class. Still, you may override this algorithm by
setting the context explicitly.

<pre>
  if_permitted_to :read, :home_branch, :context =&gt; :branches
  if_permitted_to :read, :branch =&gt; :main_company, :context =&gt; :companies
</pre>
</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000198-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000198-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 420</span>
420:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">if_permitted_to</span> (<span class="ruby-identifier">privilege</span>, <span class="ruby-identifier">attr_or_hash</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">options</span> = {})
421:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;if_permitted_to only in has_permission blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_rule</span>.<span class="ruby-identifier">nil?</span>
422:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:context</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">attr_or_hash</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:context</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attr_or_hash</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
423:         <span class="ruby-comment cmt"># only :context option in attr_or_hash:</span>
424:         <span class="ruby-identifier">attr_or_hash</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attr_or_hash</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">attr_or_hash</span>.<span class="ruby-identifier">empty?</span>
425:         <span class="ruby-ivar">@current_rule</span>.<span class="ruby-identifier">append_attribute</span> <span class="ruby-constant">AttributeWithPermission</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">privilege</span>,
426:             <span class="ruby-identifier">attr_or_hash</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:context</span>])
427:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000191" class="method-detail">
        <a name="M000191"></a>

        <div class="method-heading">
          <a href="#M000191" class="method-signature">
          <span class="method-name">includes</span><span class="method-args">(*roles)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Roles may inherit all the rights from subroles. The given <tt>roles</tt>
become subroles of the current block&#8216;s <a
href="AuthorizationRulesReader.html#M000190">role</a>.
</p>
<pre>
  role :admin do
    includes :user
    has_permission_on :employees, :to =&gt; [:update, :create]
  end
  role :user do
    has_permission_on :employees, :to =&gt; :read
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000191-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000191-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 214</span>
214:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">includes</span> (<span class="ruby-operator">*</span><span class="ruby-identifier">roles</span>)
215:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;includes only in role blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_role</span>.<span class="ruby-identifier">nil?</span>
216:         <span class="ruby-ivar">@role_hierarchy</span>[<span class="ruby-ivar">@current_role</span>] <span class="ruby-operator">||=</span> []
217:         <span class="ruby-ivar">@role_hierarchy</span>[<span class="ruby-ivar">@current_role</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">flatten</span>
218:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000203" class="method-detail">
        <a name="M000203"></a>

        <div class="method-heading">
          <a href="#M000203" class="method-signature">
          <span class="method-name">intersects_with</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
In an <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
statement, <a
href="AuthorizationRulesReader.html#M000203">intersects_with</a> requires
that at least one of the values has <a
href="AuthorizationRulesReader.html#M000196">to</a> be part of the
collection specified by the <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a> attribute.
The value block needs <a
href="AuthorizationRulesReader.html#M000196">to</a> evaluate <a
href="AuthorizationRulesReader.html#M000196">to</a> an Enumerable. For
information on the block argument, see <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000203-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000203-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 458</span>
458:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">intersects_with</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
459:         [<span class="ruby-identifier">:intersects_with</span>, <span class="ruby-identifier">block</span>]
460:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000199" class="method-detail">
        <a name="M000199"></a>

        <div class="method-heading">
          <a href="#M000199" class="method-signature">
          <span class="method-name">is</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
In an <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
statement, <a href="AuthorizationRulesReader.html#M000199">is</a> says that
the value has <a href="AuthorizationRulesReader.html#M000196">to</a> be met
exactly by the <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a> attribute.
For information on the block argument, see <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000199-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000199-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 432</span>
432:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
433:         [<span class="ruby-identifier">:is</span>, <span class="ruby-identifier">block</span>]
434:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000204" class="method-detail">
        <a name="M000204"></a>

        <div class="method-heading">
          <a href="#M000204" class="method-signature">
          <span class="method-name">is_in</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
In an <a href="AuthorizationRulesReader.html#M000197">if_attribute</a>
statement, <a href="AuthorizationRulesReader.html#M000204">is_in</a> says
that the value has <a href="AuthorizationRulesReader.html#M000196">to</a>
contain the attribute value. For information on the block argument, see <a
href="AuthorizationRulesReader.html#M000197">if_attribute</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000204-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000204-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 465</span>
465:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_in</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
466:         [<span class="ruby-identifier">:is_in</span>, <span class="ruby-identifier">block</span>]
467:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000200" class="method-detail">
        <a name="M000200"></a>

        <div class="method-heading">
          <a href="#M000200" class="method-signature">
          <span class="method-name">is_not</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The negation of <a href="AuthorizationRulesReader.html#M000199">is</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000200-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000200-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 437</span>
437:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_not</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
438:         [<span class="ruby-identifier">:is_not</span>, <span class="ruby-identifier">block</span>]
439:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000205" class="method-detail">
        <a name="M000205"></a>

        <div class="method-heading">
          <a href="#M000205" class="method-signature">
          <span class="method-name">is_not_in</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The negation of <a href="AuthorizationRulesReader.html#M000204">is_in</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000205-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000205-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 470</span>
470:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_not_in</span> (<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
471:         [<span class="ruby-identifier">:is_not_in</span>, <span class="ruby-identifier">block</span>]
472:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000190" class="method-detail">
        <a name="M000190"></a>

        <div class="method-heading">
          <a href="#M000190" class="method-signature">
          <span class="method-name">role</span><span class="method-args">(role, options = {}) {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Defines the authorization rules for the given <tt><a
href="AuthorizationRulesReader.html#M000190">role</a></tt> in the following
block.
</p>
<pre>
  role :admin do
    has_permissions_on ...
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000190-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000190-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 196</span>
196:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">role</span> (<span class="ruby-identifier">role</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
197:         <span class="ruby-identifier">append_role</span> <span class="ruby-identifier">role</span>, <span class="ruby-identifier">options</span>
198:         <span class="ruby-ivar">@current_role</span> = <span class="ruby-identifier">role</span>
199:         <span class="ruby-keyword kw">yield</span>
200:       <span class="ruby-keyword kw">ensure</span>
201:         <span class="ruby-ivar">@current_role</span> = <span class="ruby-keyword kw">nil</span>
202:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000195" class="method-detail">
        <a name="M000195"></a>

        <div class="method-heading">
          <a href="#M000195" class="method-signature">
          <span class="method-name">title</span><span class="method-args">(text)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets a human-readable <a
href="AuthorizationRulesReader.html#M000195">title</a> for the current <a
href="AuthorizationRulesReader.html#M000190">role</a>. E.g.
</p>
<pre>
  role :admin
    title &quot;Administrator&quot;
    has_permission_on ...
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000195-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000195-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 296</span>
296:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">title</span> (<span class="ruby-identifier">text</span>)
297:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;title only allowed in role blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_role</span>.<span class="ruby-identifier">nil?</span>
298:         <span class="ruby-identifier">role_titles</span>[<span class="ruby-ivar">@current_role</span>] = <span class="ruby-identifier">text</span>
299:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000196" class="method-detail">
        <a name="M000196"></a>

        <div class="method-heading">
          <a href="#M000196" class="method-signature">
          <span class="method-name">to</span><span class="method-args">(*privs)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used in a <a
href="AuthorizationRulesReader.html#M000192">has_permission_on</a> block,
<a href="AuthorizationRulesReader.html#M000196">to</a> may be used <a
href="AuthorizationRulesReader.html#M000196">to</a> specify privileges <a
href="AuthorizationRulesReader.html#M000196">to</a> be assigned <a
href="AuthorizationRulesReader.html#M000196">to</a> the current <a
href="AuthorizationRulesReader.html#M000190">role</a> under the conditions
specified in the current block.
</p>
<pre>
  role :admin
    has_permission_on :employees do
      to :create, :read, :update, :delete
    end
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000196-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000196-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/reader.rb, line 309</span>
309:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to</span> (<span class="ruby-operator">*</span><span class="ruby-identifier">privs</span>)
310:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DSLError</span>, <span class="ruby-value str">&quot;to only allowed in has_permission_on blocks&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_rule</span>.<span class="ruby-identifier">nil?</span>
311:         <span class="ruby-ivar">@current_rule</span>.<span class="ruby-identifier">append_privileges</span>(<span class="ruby-identifier">privs</span>)
312:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>