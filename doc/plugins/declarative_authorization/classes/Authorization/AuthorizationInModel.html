<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Authorization::AuthorizationInModel</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Authorization::AuthorizationInModel</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model_rb.html">
                vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000011">after_find</a>&nbsp;&nbsp;
      <a href="#M000008">obligation_scope_for</a>&nbsp;&nbsp;
      <a href="#M000007">permitted_to!</a>&nbsp;&nbsp;
      <a href="#M000006">permitted_to?</a>&nbsp;&nbsp;
      <a href="#M000010">using_access_control</a>&nbsp;&nbsp;
      <a href="#M000013">using_access_control?</a>&nbsp;&nbsp;
      <a href="#M000012">using_access_control?</a>&nbsp;&nbsp;
      <a href="#M000009">with_permissions_to</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">obligation_scope_for</span><span class="method-args">( privileges, options = {} )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Builds and returns a scope with joins and conditions satisfying all
obligations.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 63</span>
63:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">obligation_scope_for</span>( <span class="ruby-identifier">privileges</span>, <span class="ruby-identifier">options</span> = {} )
64:           <span class="ruby-identifier">options</span> = {
65:             <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Authorization</span>.<span class="ruby-identifier">current_user</span>,
66:             <span class="ruby-identifier">:context</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
67:             <span class="ruby-identifier">:model</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>,
68:             <span class="ruby-identifier">:engine</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
69:           }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
70:           <span class="ruby-identifier">engine</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:engine</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Authorization</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>.<span class="ruby-identifier">instance</span>
71: 
72:           <span class="ruby-identifier">obligation_scope</span> = <span class="ruby-constant">ObligationScope</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:model</span>], {} )
73:           <span class="ruby-identifier">engine</span>.<span class="ruby-identifier">obligations</span>( <span class="ruby-identifier">privileges</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>], <span class="ruby-identifier">:context</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:context</span>] ).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obligation</span><span class="ruby-operator">|</span>
74:             <span class="ruby-identifier">obligation_scope</span>.<span class="ruby-identifier">parse!</span>( <span class="ruby-identifier">obligation</span> )
75:           <span class="ruby-keyword kw">end</span>
76: 
77:           <span class="ruby-identifier">obligation_scope</span>.<span class="ruby-identifier">scope</span>
78:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">using_access_control</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Activates model security for the current model. Then, CRUD operations are
checked against the authorization of the current user. The privileges are
:<tt>create</tt>, :<tt>read</tt>, :<tt>update</tt> and :<tt>delete</tt> in
the context of the model. By default, :<tt>read</tt> is not checked because
of performance impacts, especially with large result sets.
</p>
<pre>
  class User &lt; ActiveRecord::Base
    using_access_control
  end
</pre>
<p>
If an operation is not permitted, a <a
href="AuthorizationError.html">Authorization::AuthorizationError</a> is
raised.
</p>
<p>
To activate model security on all models, call <a
href="AuthorizationInModel.html#M000010">using_access_control</a> on
ActiveRecord::Base
</p>
<pre>
  ActiveRecord::Base.using_access_control
</pre>
<p>
Available options
</p>
<dl>
<dt>:<tt>context</tt></dt><dd>Specify context different from the models table name.

</dd>
<dt>:<tt>include_read</tt></dt><dd>Also check for :<tt>read</tt> privilege after find.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 123</span>
123:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">using_access_control</span> (<span class="ruby-identifier">options</span> = {})
124:           <span class="ruby-identifier">options</span> = {
125:             <span class="ruby-identifier">:context</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
126:             <span class="ruby-identifier">:include_read</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
127:           }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
128: 
129:           <span class="ruby-identifier">class_eval</span> <span class="ruby-keyword kw">do</span>
130:             [<span class="ruby-identifier">:create</span>, <span class="ruby-identifier">:update</span>, [<span class="ruby-identifier">:destroy</span>, <span class="ruby-identifier">:delete</span>]].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">privilege</span><span class="ruby-operator">|</span>
131:               <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;before_#{action}&quot;</span><span class="ruby-node">&quot;before_#{action}&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
132:                 <span class="ruby-constant">Authorization</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">permit!</span>(<span class="ruby-identifier">privilege</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">action</span>,
133:                   <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">object</span>, <span class="ruby-identifier">:context</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:context</span>])
134:               <span class="ruby-keyword kw">end</span>
135:             <span class="ruby-keyword kw">end</span>
136:             
137:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_read</span>]
138:               <span class="ruby-comment cmt"># after_find is only called if after_find is implemented</span>
139:               <span class="ruby-identifier">after_find</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
140:                 <span class="ruby-constant">Authorization</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">permit!</span>(<span class="ruby-identifier">:read</span>, <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">object</span>,
141:                   <span class="ruby-identifier">:context</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:context</span>])
142:               <span class="ruby-keyword kw">end</span>
143: 
144:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value str">&quot;3&quot;</span>
145:                 <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_find</span>; <span class="ruby-keyword kw">end</span>
146:               <span class="ruby-keyword kw">end</span>
147:             <span class="ruby-keyword kw">end</span>
148: 
149:             <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">using_access_control?</span>
150:               <span class="ruby-keyword kw">true</span>
151:             <span class="ruby-keyword kw">end</span>
152:           <span class="ruby-keyword kw">end</span>
153:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">using_access_control?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the model is using model security.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 156</span>
156:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">using_access_control?</span>
157:           <span class="ruby-keyword kw">false</span>
158:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">using_access_control?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 149</span>
149:             <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">using_access_control?</span>
150:               <span class="ruby-keyword kw">true</span>
151:             <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">with_permissions_to</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Named scope for limiting query results according to the authorization of
the current user. If no privilege is given, :<tt>read</tt> is assumed.
</p>
<pre>
  User.with_permissions_to
  User.with_permissions_to(:update)
  User.with_permissions_to(:update, :context =&gt; :users)
</pre>
<p>
As in the case of other named scopes, this one may be chained:
</p>
<pre>
  User.with_permission_to.find(:all, :conditions...)
</pre>
<p>
Options
</p>
<dl>
<dt>:<tt>context</tt></dt><dd>Context for the privilege to be evaluated in; defaults to the model&#8216;s
table name.

</dd>
<dt>:<tt>user</tt></dt><dd>User to be used for gathering obligations; defaults to the current user.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 98</span>
 98:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">with_permissions_to</span> (<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
 99:           <span class="ruby-identifier">scopes</span>[<span class="ruby-identifier">:with_permissions_to</span>].<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
100:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">after_find</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 145</span>
145:                 <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_find</span>; <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">permitted_to!</span><span class="method-args">(privilege, options = {} )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Works similar to the <a
href="AuthorizationInModel.html#M000006">permitted_to?</a> method, but
doesn&#8216;t accept a block and throws the authorization exceptions, just
like Engine#permit!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 24</span>
24:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">permitted_to!</span> (<span class="ruby-identifier">privilege</span>, <span class="ruby-identifier">options</span> = {} )
25:       <span class="ruby-identifier">options</span> = {
26:         <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-constant">Authorization</span>.<span class="ruby-identifier">current_user</span>,
27:         <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>
28:       }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
29:       <span class="ruby-constant">Authorization</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">permit!</span>(<span class="ruby-identifier">privilege</span>,
30:           {<span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>],
31:            <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:object</span>]})
32:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">permitted_to?</span><span class="method-args">(privilege, options = {}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If the user meets the given privilege, <a
href="AuthorizationInModel.html#M000006">permitted_to?</a> returns true and
yields to the optional block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/declarative_authorization/lib/declarative_authorization/in_model.rb, line 11</span>
11:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">permitted_to?</span> (<span class="ruby-identifier">privilege</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
12:       <span class="ruby-identifier">options</span> = {
13:         <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-constant">Authorization</span>.<span class="ruby-identifier">current_user</span>,
14:         <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>
15:       }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
16:       <span class="ruby-constant">Authorization</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">permit?</span>(<span class="ruby-identifier">privilege</span>,
17:           {<span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>],
18:            <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:object</span>]},
19:           <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
20:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>